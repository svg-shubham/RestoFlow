{% extends 'base.html' %}

{% block title %}Floor Management | RestoFlow{% endblock %}

{% block content %}
<style>
    /* Dashboard & Tabs Styling */
    .floor-container { background: #f4f7f6; min-height: 100vh; padding-top: 20px; }
    .nav-pills .nav-link { color: #555; font-weight: 600; padding: 10px 20px; border-radius: 10px; transition: 0.3s; }
    .nav-pills .nav-link.active { background-color: #2c3e50 !important; color: white !important; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

    /* Table & Chairs Visual Engine */
    .table-wrapper {
        position: relative;
        width: 100px;
        height: 100px;
        margin: 25px auto;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Central Table Object */
    .table-core {
        width: 60px;
        height: 60px;
        background: #ffffff;
        border: 4px solid #95a5a6;
        border-radius: 12px;
        z-index: 2;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 1.2rem;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        transition: 0.3s;
    }

    /* Individual Chairs */
    .chair {
        position: absolute;
        width: 18px;
        height: 10px;
        background: #bdc3c7;
        border-radius: 4px;
        z-index: 1;
        transition: 0.3s;
    }

    /* Positioning for 6-Seater Layout */
    .chair-top { top: -5px; left: 50%; transform: translateX(-50%); }
    .chair-bottom { bottom: -5px; left: 50%; transform: translateX(-50%); }
    .chair-left { left: -5px; top: 50%; transform: translateY(-50%) rotate(90deg); }
    .chair-right { right: -5px; top: 50%; transform: translateY(-50%) rotate(90deg); }
    .chair-top-left { top: 10px; left: 0px; transform: rotate(-45deg); }
    .chair-top-right { top: 10px; right: 0px; transform: rotate(45deg); }

    /* Status Specific Colors */
    /* 1. Available (Green) */
    .status-available .table-core { border-color: #2ecc71; color: #2ecc71; }
    .status-available .chair { background: #2ecc71; opacity: 0.6; }

    /* 2. Occupied (Red) */
    .status-occupied .table-core { border-color: #e74c3c; background: #e74c3c; color: white; }
    .status-occupied .chair { background: #e74c3c; }

    /* 3. Reserved (Yellow) */
    .status-reserved .table-core { border-color: #f1c40f; color: #f39c12; }
    .status-reserved .chair { background: #f1c40f; }

    /* 4. Out of Order (Grey) */
    .status-out_of_order .table-core { border-color: #7f8c8d; background: #ecf0f1; color: #95a5a6; }
    .status-out_of_order .chair { background: #95a5a6; }

    /* Card Hover Effect */
    .table-card { border-radius: 15px; border: none; transition: 0.3s; }
    .table-card:hover { transform: translateY(-8px); box-shadow: 0 12px 20px rgba(0,0,0,0.1) !important; }
</style>

<div class="floor-container">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center mb-4 px-3">
            <div>
                <h2 class="fw-bold mb-0">Floor Management</h2>
                <p class="text-muted">Live table status and order tracking</p>
            </div>
            <div class="d-flex gap-2">
                <span class="badge bg-success py-2 px-3">Available: {{ available_count }}</span>
                <span class="badge bg-danger py-2 px-3">Occupied: {{ occupied_count }}</span>
            </div>
        </div>

        <ul class="nav nav-pills mb-4 bg-white p-2 rounded-3 shadow-sm mx-3" id="pills-tab" role="tablist">
            {% for section in sections %}
            <li class="nav-item" role="presentation">
                <button class="nav-link {% if forloop.first %}active{% endif %}" 
                        id="tab-{{ section.id }}" data-bs-toggle="pill" 
                        data-bs-target="#sec-{{ section.id }}" type="button">
                    {{ section.name }}
                </button>
            </li>
            {% endfor %}
        </ul>

        <div class="tab-content px-3" id="pills-tabContent">
            {% for section in sections %}
            <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="sec-{{ section.id }}">
                <div class="row g-4">
                    {% for table in section.tables.all %}
                    <div class="col-6 col-md-4 col-lg-3 col-xl-2">
                        <div class="card table-card shadow-sm status-{{ table.status|lower }}">
                            <div class="card-body">
                                <div class="table-wrapper">
                                    <div class="table-core">
                                        {{ table.table_number }}
                                    </div>
                                    
                                    {% if table.capacity >= 1 %}<div class="chair chair-top"></div>{% endif %}
                                    {% if table.capacity >= 2 %}<div class="chair chair-bottom"></div>{% endif %}
                                    {% if table.capacity >= 3 %}<div class="chair chair-left"></div>{% endif %}
                                    {% if table.capacity >= 4 %}<div class="chair chair-right"></div>{% endif %}
                                    {% if table.capacity >= 5 %}<div class="chair chair-top-left"></div>{% endif %}
                                    {% if table.capacity >= 6 %}<div class="chair chair-top-right"></div>{% endif %}
                                </div>

                                <div class="text-center mt-2">
                                    <p class="small text-muted mb-1">{{ table.get_status_display }}</p>
                                    <h6 class="fw-bold">{{ table.capacity }} Seater</h6>
                                </div>

                                <div class="mt-3">
                                    {% if table.status == 'AVAILABLE' %}
                                        <a href="{% url 'initiate_order' table.id %}" class="btn btn-sm btn-outline-success w-100 rounded-pill">
                                            <i class="bi bi-plus-circle me-1"></i> Take Order
                                        </a>
                                    {% elif table.status == 'OCCUPIED' %}
                                        <a href="{% url 'initiate_order' table.id %}" class="btn btn-sm btn-danger w-100 rounded-pill shadow-sm">
                                            <i class="bi bi-eye me-1"></i> View/Add Items
                                        </a>
                                    {% else %}
                                        <button class="btn btn-sm btn-secondary w-100 rounded-pill disabled" disabled>Blocked</button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-inbox fs-1 text-muted"></i>
                        <p class="text-muted mt-2">No tables found in this section.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}